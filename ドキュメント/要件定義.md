目的

# 要件定義書

## 1. プロジェクト概要

- **目的**：アニメグッズ専門の商品情報を対象サイトからスクレイピングし、商品情報の一覧表示する。
- **対象サイト**：構造固定のアニメグッズ販売サイト複数（専用パーサー利用）。サイトは運営側で固定。
- **特徴**：URL登録からスクレイピング実行、商品情報取得・管理、取得履歴保存をNext.jsのAPI Routesを用いて実装。

## 2. 想定ユーザー

- アニメグッズ収集・情報整理を目的とするユーザー

## 3. 技術スタック

| 層 | 技術 | 備考 |
| --- | --- | --- |
| フロントエンド | Next.js（React） + Tailwind CSS | SPAとして構築 |
| バックエンド | Next.js API Routes（Node.js、TypeScript） | スクレイピングロジック含む |
| データベース | PostgreSQL + Prisma ORM | 型安全かつ運用効率向上 |
| スクレイピング | axios + Cheerio | HTTP取得＋HTML解析 |
| CI/CD | GitHub Actions | コード自動テスト＆デプロイ |
| ホスティング | Vercel | フロント・API一元管理 |

## 4. 機能要件（MVP）

### 4.1 バッチで定期的にスクレイピング

- 定期的に対象サイトからグッズ情報を収集する。
- 取得商品情報をDBに保存する。
- 
### 4.2 商品情報一覧表示

- DBから収集した商品を取得し、カード形式で一覧表示。
- 各カードに商品タイトル、商品画像、価格、詳細ページリンクを表示。

### 4.3 エラー表示

- APIレスポンスにエラーメッセージを含め、画面に表示。

---

## 5. 非機能要件

### 5.1 拡張性

- 将来的に複数サイト対応を見据え、パーサー処理はモジュール化・抽象化。

### 5.2 API設計

- APIは共通レスポンスフォーマットを採用。

```json
json
コピーする編集する
{
  "success": true,
  "data": {...},
  "error": null}

```

- エラー時は`success: false`、`error`に詳細情報を含む。

### 5.3 セキュリティ

- サーバからの情報をページ上に表示するだけなので、XSS対策のみ

### 5.4 運用監視・ログ

- エラーログ（スクレイピング例外情報）をDBに記録。
- APIアクセスログ（日時・エンドポイント・ステータス）を収集。
- 処理時間や成功・失敗ステータスを記録しパフォーマンス監視に活用。

### 5.5 CI/CD

- GitHub Actionsで主要API・スクレイピングロジックのユニットテストを自動実行。
- Vercelへの自動デプロイを設定。
- E2Eテストはリリース後検討。

---

## 6. 画面構成

| 画面名 | 概要 | 主なUI要素 |
| --- | --- | --- |
ヘッダー、商品カード一覧、ロードアイコン、エラーメッセージ表示領域

---

---

## 8. APIエンドポイント例

| HTTPメソッド | エンドポイント | 説明 | リクエスト | レスポンス例 |
| --- | --- | --- | --- | --- |
| GET | /api/products | 直近のスクレイピングで取得した商品一覧取得 | なし | { success: true, data: [ { title, imageUrl, price, detailUrl } ], error: null } |

---

## 9. 今後の拡張検討事項

- 複数サイト対応（パーサー切替）
- 非同期スクレイピング実行＋ジョブステータス監視UIの導入
- エラーハンドリング強化とリトライ機能
- ユーザー認証・登録機能追加
- E2Eテスト導入・CI/CD強化
- 外部ログ監視サービス連携
